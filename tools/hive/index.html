<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Project Nessie: A Git-like Experience for your Data Lake"><link rel="shortcut icon" href=../../images/fav2.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.0.1"><title>Hive - Project Nessie: A Git-like Experience for your Data Lake</title><link rel=stylesheet href=../../assets/stylesheets/main.38780c08.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f72e892.min.css><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-177850801-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#hive class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=../.. title="Project Nessie: A Git-like Experience for your Data Lake" class="md-header-nav__button md-logo" aria-label="Project Nessie: A Git-like Experience for your Data Lake"> <img src=../../img/small.svg alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Project Nessie: A Git-like Experience for your Data Lake </span> <span class="md-header-nav__topic md-ellipsis"> Hive </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/projectnessie/nessie title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../features/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../../tables/ class=md-tabs__link> Table & Views </a> </li> <li class=md-tabs__item> <a href=../ class="md-tabs__link md-tabs__link--active"> Tools & Integrations </a> </li> <li class=md-tabs__item> <a href=../../develop/ class=md-tabs__link> Develop </a> </li> <li class=md-tabs__item> <a href=../../try/ class=md-tabs__link> Try Now </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Project Nessie: A Git-like Experience for your Data Lake" class="md-nav__button md-logo" aria-label="Project Nessie: A Git-like Experience for your Data Lake"> <img src=../../img/small.svg alt=logo> </a> Project Nessie: A Git-like Experience for your Data Lake </label> <div class=md-nav__source> <a href=https://github.com/projectnessie/nessie title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Features <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Features data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../features/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../features/transactions/ title=Transactions class=md-nav__link> Transactions </a> </li> <li class=md-nav__item> <a href=../../features/management/ title="Management Services" class=md-nav__link> Management Services </a> </li> <li class=md-nav__item> <a href=../../features/security/ title=Security class=md-nav__link> Security </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Table & Views <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Table & Views" data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"></span> Table & Views </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tables/ title=Overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../tables/iceberg/ title="Apache Iceberg" class=md-nav__link> Apache Iceberg </a> </li> <li class=md-nav__item> <a href=../../tables/deltalake/ title="Delta Lake" class=md-nav__link> Delta Lake </a> </li> <li class=md-nav__item> <a href=../../tables/hive/ title="Hive Tables" class=md-nav__link> Hive Tables </a> </li> <li class=md-nav__item> <a href=../../tables/views/ title="SQL Views" class=md-nav__link> SQL Views </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Tools & Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Tools & Integrations" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"></span> Tools & Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ title=Overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../cli/ title="Nessie CLI" class=md-nav__link> Nessie CLI </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ title=Hive class="md-nav__link md-nav__link--active"> Hive </a> </li> <li class=md-nav__item> <a href=../spark/ title=Spark class=md-nav__link> Spark </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Develop <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Develop data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"></span> Develop </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../develop/ title=Community class=md-nav__link> Community </a> </li> <li class=md-nav__item> <a href=../../develop/architecture/ title=Architecture class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../../develop/kernel/ title="Commit Kernel" class=md-nav__link> Commit Kernel </a> </li> <li class=md-nav__item> <a href=../../develop/nessie_vs_git/ title="Nessie vs Git" class=md-nav__link> Nessie vs Git </a> </li> <li class=md-nav__item> <a href=../../develop/rest/ title="Rest API" class=md-nav__link> Rest API </a> </li> <li class=md-nav__item> <a href=../../develop/python/ title=Python class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../develop/java/ title=Java class=md-nav__link> Java </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Try Now <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Try Now" data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"></span> Try Now </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../try/ title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../try/configuration/ title=Configuration class=md-nav__link> Configuration </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=hive>Hive<a class=headerlink href=#hive title="Permanent link">&para;</a></h1> <p>Nessie provides offers an optional component called the HMS Bridge Service. It allows you to run a vanilla Hive Metastore server that is enhanced to also support Nessie capabilities. This can be used to expose Nessie functionality to Hive or any Hive metastore compatible tool (such as <a href=https://docs.aws.amazon.com/athena/latest/ug/connect-to-data-source-hive.html>AWS Athena</a>).</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>HMS here stands for Hive Metastore and is not related to the <a href=https://en.wikipedia.org/wiki/HMS_Queen_Elizabeth_(R08)>HMS Queen Elizabeth</a> or her sisterships.</p> </div> <h1 id=how-it-works>How It Works<a class=headerlink href=#how-it-works title="Permanent link">&para;</a></h1> <p>The HMS Bridge implements a new <a href=https://hive.apache.org/javadocs/r3.1.2/api/org/apache/hadoop/hive/metastore/RawStore.html>RawStore</a> for the Hive metastore. The RawStore is an interface that Hive exposes to provide alternative backing storage systems. Typically, people use the default option of <a href=https://hive.apache.org/javadocs/r3.1.2/api/org/apache/hadoop/hive/metastore/ObjectStore.html>ObjectStore</a> interacting with traditional relational databases. The HMS Bridge packages the Nessie REST client and leverages the Nessie service to provide versioning capabilities for Hive databases, tables and partitions.</p> <h2 id=hms-bridge-modes>HMS Bridge Modes<a class=headerlink href=#hms-bridge-modes title="Permanent link">&para;</a></h2> <p>The HMS Bridge can run in two ways: </p> <dl> <dt><strong>Pure Nessie</strong></dt> <dd>In this mode, all tables are Nessie based and no backing relational store is required. This is appropriate for new deployments.</dd> <dt><strong>Delegation Mode</strong></dt> <dd>In this mode the HMS Bridge can enhance your existing Hive Metastore. In this mode, your Hive metastore works as it does without the HMS Bridge for all but a set of whitelisted databases. When you interact with those whitelisted databases, you&rsquo;ll have Nessie&rsquo;s versioning capabilities. This allows people who are already using Hive metastore extensively to continue to do so while still taking advantage of Nessie&rsquo;s capabilities for some tables and databases.</dd> </dl> <h2 id=setup>Setup<a class=headerlink href=#setup title="Permanent link">&para;</a></h2> <p>Currently, the HMS Bridge works with Hive 2.x and Hive 3.x. To get started, do the following steps:</p> <ol> <li>Install Hive (2.3.7, 3.1.2, or similar). The easiest way is to download a <a href=https://hive.apache.org/downloads.html>tarball from Apache</a>.</li> <li> <p>Grab a <a href="https://github.com/orgs/projectnessie/packages?tab=packages&q=hms">generated artifact</a> from GitHub and copy into the Hive lib folder:</p> <p>Hive 2: <code>cp nessie-hms-hive2-0.1.jar lib</code> <br> Hive 3: <code>cp nessie-hms-hive3-0.1.jar lib</code></p> </li> <li> <p>Add the following properties to hive-site.xml or similar:</p> <div class=highlight><pre><span></span><code> <span class=nt>&lt;property&gt;</span>
  <span class=nt>&lt;name&gt;</span>hive.metastore.rawstore.impl<span class=nt>&lt;/name&gt;</span>
  <span class=nt>&lt;description&gt;</span>The specific Nessie store for Hive, see list below.<span class=nt>&lt;/description&gt;</span>
  <span class=nt>&lt;value&gt;</span>org.projectnessie.Hive2NessieRawStore<span class=nt>&lt;/value&gt;</span>
 <span class=nt>&lt;/property&gt;</span>
<span class=nt>&lt;property&gt;</span>
  <span class=nt>&lt;name&gt;</span>nessie.url<span class=nt>&lt;/name&gt;</span>
  <span class=nt>&lt;description&gt;</span>
    The HTTP endpoint for the Nessie service.
  <span class=nt>&lt;/description&gt;</span>
  <span class=nt>&lt;value&gt;</span>http://localhost:19120/api/v1<span class=nt>&lt;/value&gt;</span>
<span class=nt>&lt;/property&gt;</span>
<span class=nt>&lt;property&gt;</span>
  <span class=nt>&lt;name&gt;</span>nessie.dbs<span class=nt>&lt;/name&gt;</span>
  <span class=nt>&lt;description&gt;</span>
    A whitelist of databases that should be managed by Nessie,
    only relevant when using Delegation mode.
    `$nessie` admin database is always whitelisted.
  <span class=nt>&lt;/description&gt;</span>
  <span class=nt>&lt;value&gt;</span>nessiedb,mynessiedb,git4data<span class=nt>&lt;/value&gt;</span>
<span class=nt>&lt;/property&gt;</span>
</code></pre></div> <table> <thead> <tr> <th>Class</th> <th>Hive Version</th> <th>Mode</th> </tr> </thead> <tbody> <tr> <td>org.projectnessie.Hive2NessieRawStore</td> <td>Hive 2</td> <td>Nessie Only</td> </tr> <tr> <td>org.projectnessie.DelegatingHive2NessieRawStore</td> <td>Hive 2</td> <td>Nessie + Legacy Tables</td> </tr> <tr> <td>org.projectnessie.Hive3NessieRawStore</td> <td>Hive 3</td> <td>Nessie Only</td> </tr> <tr> <td>org.projectnessie.DelegatingHive3NessieRawStore</td> <td>Hive 3</td> <td>Nessie + Legacy Tables</td> </tr> </tbody> </table> </li> <li> <p>Start the metastore with <code>bin/hive --service metastore</code></p> </li> <li>Start working with Hive Metastore using HMS Bridge. If you&rsquo;ve chosen delegation mode, your existing Hive Metastore tables will continue to exist.</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>In Hive 3 there is something called Hive Metastore &ldquo;Standalone&rdquo; mode. This was designed to try to support Kafka schema registry scenarios. It does not come packaged with sufficient capabilities to work as a Hive Metastore for querying purposes. To use Hive in this context you need a complete Hive install (the same as using Hive Metastore without Nessie). </p> </div> <h2 id=use>Use<a class=headerlink href=#use title="Permanent link">&para;</a></h2> <h3 id=whats-supported>What&rsquo;s Supported<a class=headerlink href=#whats-supported title="Permanent link">&para;</a></h3> <p>Because Nessie Tables provide a set of new capabilities beyond what Hive has traditionally done, only a subset of Hive features are available with these tables. (If you are running in Nessie + Legacy mode, this only applies to Nessie tables, legacy tables will continue to operate as they do today.) These features currently include:</p> <ul> <li>CREATE, ALTER and DROP of:<ul> <li>databases</li> <li>external tables</li> <li>views</li> </ul> </li> <li>Inserting data into an empty table</li> <li>ADD and DROP for partitions</li> <li>Altering table properties</li> </ul> <p>Note: When using external tables with HMS Bridge, the tables must be created with the &ldquo;immutable=true&rdquo; property. Nessie reject tables that are not configured with this property. This property does not mean the tables are immutable. What it does is disable Hive from mutating a tables state without informing the Hive metastore. This guarantees that Hive versions are maintained correctly.</p> <h3 id=query-semantics>Query Semantics<a class=headerlink href=#query-semantics title="Permanent link">&para;</a></h3> <p>By default, Hive will work with the default branch configured in Nessie. You can do normal operations against your Hive metastore and Nessie will behave just like a traditional metastore. However, under the covers, Nessie is versioning all changes to your Hive metastore. This allows to do more fancy things as well.</p> <p>Because Hive does not natively support Branching and Tags, Nessie presents a pseudo-database called &lsquo;$nessie&rsquo; which can be used within a HiveQL context to: * list available branches &amp; tags * change the default ref for your session * create tags and branches</p> <h4 id=list-available-branches-and-tags>List available branches and tags<a class=headerlink href=#list-available-branches-and-tags title="Permanent link">&para;</a></h4> <p>You can list available named references within Nessie by listing the tables in the $nessie database.</p> <div class=highlight><pre><span></span><code>hive&gt; SHOW TABLES IN `$nessie` 
OK
main
dev
...
</code></pre></div> <h4 id=create-new-branch-or-tag>Create New Branch or Tag<a class=headerlink href=#create-new-branch-or-tag title="Permanent link">&para;</a></h4> <p>To create a branch or tag, you will use CREATE VIEW syntax along with a dummy SQL query. The name of the view will be the new named reference. You can optionally provide <code>type</code> and <code>ref</code> parameters to further define your new object.</p> <p>||property||description|| |<code>type</code>|Defaults to <code>branch</code>. Whether to create a named reference of type <code>tag</code> or <code>branch</code>| |<code>ref</code>|Defaults to the head of the current default branch (typically <code>main</code>). Can be set to either a hash, branch or tag. If set to a tag or branch, resolves the named reference to a hash for creation.|</p> <p>Example uses:</p> <div class=highlight><pre><span></span><code># create a new branch called my_new_branch pointing to the HEAD of the current ref context.
hive&gt; CREATE VIEW `$nessie`.my_new_branch AS SELECT 1;
OK
# create a new tag called my_new_tag pointing to the current tip of the default branch.
hive&gt; CREATE VIEW `$nessie`.my_new_tag TBLPROPERTIES(&quot;type&quot;=&quot;tag&quot;) AS SELECT 1;
OK
# create a new tag called my_new_specific_tag that points to the reference &quot;abcd...&quot;
hive&gt; CREATE VIEW `$nessie`.my_new_specific_tag TBLPROPERTIES(&quot;type&quot;=&quot;tag&quot;, &quot;ref&quot;=&quot;abcd...&quot;) AS SELECT 1;
OK
</code></pre></div> <p>Note: The <code>SELECT 1</code> in the queries above is arbitrary and only serves to allow Hive to understand the HiveQL operation and then delegate it to Nessie. Any valid SQL can be provided there and will be thrown away, not stored. If you are running in Hive 2, it doesn&rsquo;t support creating views of queries without a FROM clause. In those cases, you&rsquo;ll need to use some other dummy statement such as <code>SELECT * from &lt;known table&gt; LIMIT 1</code>.</p> <h4 id=set-your-context>Set Your Context<a class=headerlink href=#set-your-context title="Permanent link">&para;</a></h4> <p>To change the context of the environment your session is working within, you will alter the <code>$nessie</code> database. You can set the default context to any valid Nessie reference. For example:</p> <p><div class=highlight><pre><span></span><code>hive&gt; ALTER DATABASE `$nessie` SET DBPROPERTIES (&quot;ref&quot;=&quot;my_special_branch&quot;)
OK
</code></pre></div> Once you change context, all read operations will default to that context for the life of that session. All write operations will also be done within that context.</p> <h4 id=querying-across-multiple-contexts>Querying across multiple contexts<a class=headerlink href=#querying-across-multiple-contexts title="Permanent link">&para;</a></h4> <p>You can use absolute references to query across context. You do this by appending <code>@&lt;refname&gt;</code> to the table you want to query. For example, if you want to see all records in a table from yesterday and now, you might write a query such as:</p> <div class=highlight><pre><span></span><code>hive&gt; SELECT * from t1 UNION ALL `t1@yesterday`
OK
</code></pre></div> <p>This can be used to directly access any available reference within Nessie</p> <div class=highlight><pre><span></span><code>hive&gt; SELECT * from `t1@prod_data_branch` UNION ALL `t1@my_special_tag` UNION ALL `t1@2019-12-25`
OK
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>You can only use absolute references (t1@<ref>) for SELECT queries. For mutation operations (such as CREATE/ALTER/DROP), you must first assign the context that you want to do the operation within. IOW, absolute references are read-only.</p> </div> <h3 id=not-yet-supported>Not Yet Supported<a class=headerlink href=#not-yet-supported title="Permanent link">&para;</a></h3> <p>Because Nessie has a special way of representing the data, the following types of objects and operations are not currently supported:</p> <ul> <li>Grants, role, privileges</li> <li>Statistics</li> <li>Functions</li> <li>Tokens</li> <li>Notifications</li> <li>Constraints and referential integrity (primary/foreign keys)</li> </ul> <h3 id=file-management>File Management<a class=headerlink href=#file-management title="Permanent link">&para;</a></h3> <p>When using Nessie with Hive, you must rely on Nessie&rsquo;s garbage collection system in order to clean up files that are no longer referenced. Because there may be historical versions of tables pointing to specific files, using an external process to delete those files when not instructed/managed by Nessie will result in historical queries returning partial datasets. Because of this, the following tables types are unlikely to ever be supported by Nessie&rsquo;s versioning management system:</p> <ul> <li>Internal tables (Hive doesn&rsquo;t import metastore about changes)</li> <li>External tables without the &ldquo;immutable=true&rdquo; property. </li> </ul> <p>Additionally, when creating a new external table, Nessie will always prepend the table&rsquo;s location with a randomly generated Guid. This ensures the following set of operations still maintain history and work as expectd:</p> <div class=highlight><pre><span></span><code>hive&gt; CREATE EXTERNAL TABLE t1 (a int, b int) PARTITIONED BY (c int) TBLPROPERTIES (&quot;immutable&quot;=&quot;true&quot;);
OK
hive&gt; INSERT TABLE t1 PARTITION(c) SELECT 1 AS a, 1 AS b,1 AS c UNION ALL SELECT 2,2,2 UNION ALL SELECT 3,3,3;
...
OK
hive&gt; CREATE VIEW `$nessie`.original AS SELECT 1;
OK
hive&gt; DROP TABLE t1;
OK
hive&gt; CREATE EXTERNAL TABLE t1 (a int, b int) PARTITIONED BY (c int) TBLPROPERTIES (&quot;immutable&quot;=&quot;true&quot;);
OK
hive&gt; INSERT TABLE t1 PARTITION(c) SELECT 10 AS a, 10 AS b, 1 AS c;
...
OK
</code></pre></div> <p>In this situation, Nessie&rsquo;s versioning is in full effect. If I query <code>t1</code>, I will see the record with a=10. If I query <code>t1@original</code>, I will see the records with a=[1,2,3]. Without Nessie&rsquo;s automatic prefixing, default Hive behavior would actually lead to an exception when the second insertion is done since it would find a file already existing on the path of the default external table. </p> </article> </div> </div> </main> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Application footer --> <footer class=md-footer> <!-- Link to previous and/or next page --> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <!-- Link to previous page --> <a href=../cli/ title="Nessie CLI" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Nessie CLI </div> </div> </a> <!-- Link to next page --> <a href=../spark/ title=Spark class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Spark </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <!-- Copyright and theme information --> <div class=md-footer-copyright> </div> <!-- Social links --> <div class=md-footer-social> <a href=https://twitter.com/projectnessie target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://hub.docker.com/r/projectnessie/nessie target=_blank rel=noopener title=hub.docker.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href="https://www.youtube.com/channel/UC5xjzYuGGuGPCY9FNtqZMsQ?view_as=subscriber" target=_blank rel=noopener title=www.youtube.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.77e55a48.min.js></script> <script src=../../assets/javascripts/bundle.aa3f9871.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../..",
          features: ['navigation.tabs', 'navigation.expand', 'navigation.instant'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>